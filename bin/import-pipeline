#!/usr/bin/env python3
import os
import json
import sys
from optparse import OptionParser
import time
import importlib
from multiprocessing import Process

from lettucethink import fsdb

def process_block(block, scan, inputs, outputs):
    block.read_input(scan, inputs)
    block.process()
    block.write_output(scan, outputs)

def find_id(l, id):
    for x in l:
        if x['id'] == id:
            return x
    return None

if __name__ == "__main__":
    usage = "usage: %prog [options] db pipeline"
    parser = OptionParser(usage=usage)

    (options, args) = parser.parse_args()

    if '-n' in sys.argv:
        i = find('-n')

    if len(args) != 2:
        raise Exception('Wrong number of arguments. Usage: ')

    db = args[0]
    print('DB location = %s'%db)

    assert(os.path.splitext(args[1])[-1] == ".json")


    db = fsdb.DB(db)
    db.connect()

    for scan in db.get_scans():
        print(scan.id)
        scan.set_metadata('target_pipeline', json.load(open(args[1])))

